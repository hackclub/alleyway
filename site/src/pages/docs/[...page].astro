---
import Base from "@layouts/Base.astro";
import DocsBar from "@components/DocsBar.astro";
// Generate a page for every markdown file under src/docs/pub

type DocModule = {
    file: string;
    frontmatter?: Record<string, any>;
    default: any;
};

export async function getStaticPaths() {
    const docs: DocModule[] = await Astro.glob("../../docs/pub/**/*.md");

    return docs.map((doc) => {
        const normalized = doc.file.replace(/\\/g, "/");
        // Compute slug relative to src/docs/pub
        const afterRoot = normalized.split("/docs/pub/")[1] || "";
        const slug = afterRoot.replace(/\.md$/i, "");

        return {
            params: { page: slug },
            props: { doc },
        };
    });
}

const { doc } = Astro.props as { doc: DocModule };
const { default: Content, frontmatter } = doc;
---

<Base>
    <div
        class="mx-auto max-w-7xl px-4 py-8 grid grid-cols-1 md:grid-cols-[16rem_1fr] gap-8"
    >
        <DocsBar currentSlug={Astro.params.page} />
        <article class="prose prose-invert max-w-none">
            {frontmatter?.title ? <h1>{frontmatter.title}</h1> : null}
            <Content />
        </article>
    </div>
</Base>

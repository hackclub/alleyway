---
import Docs from "@layouts/Docs.astro";
// Generate a page for every markdown file under src/docs/pub

type DocModule = {
    file: string;
    frontmatter?: Record<string, any>;
    default: any;
};

export async function getStaticPaths() {
    const docs: DocModule[] = await Astro.glob("../../docs/pub/**/*.md*");

    return docs.map((doc) => {
        const normalized = doc.file.replace(/\\/g, "/");
        // Compute slug relative to src/docs/pub
        const afterRoot = normalized.split("/docs/pub/")[1] || "";
        const slug = afterRoot.replace(/\.md$/i, "");

        return {
            params: { page: slug },
            props: { doc },
        };
    });
}

const { doc } = Astro.props as { doc: DocModule };
const { default: Content, frontmatter } = doc;

console.log("Rendering doc:", frontmatter?.title, "from", doc.file);

export const prerender = true;
---

<Docs>
    <Content />
</Docs>
